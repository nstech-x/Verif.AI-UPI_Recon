# ğŸ—ï¸ SYSTEM ARCHITECTURE & DATA FLOW

## Complete System Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Browser)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    React Frontend                          â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚     App Component                  â”‚                  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚    â”‚
â”‚  â”‚  â”‚ âœ“ BrowserRouter                    â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ âœ“ AuthProvider wrapper             â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ âœ“ ProtectedRoute component         â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ âœ“ Routes configuration             â”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚           â†“                    â†“                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚  Login Page      â”‚  â”‚ Protected Pages     â”‚          â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Username       â”‚  â”‚ â€¢ Dashboard         â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Password       â”‚  â”‚ â€¢ File Upload       â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Submit button  â”‚  â”‚ â€¢ Recon Dashboard   â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Demo creds     â”‚  â”‚ â€¢ Reports           â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Error display  â”‚  â”‚ â€¢ And 7 more...     â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚           â†“                    â†“                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚   Layout Component                 â”‚                  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Sidebar Navigation               â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ User Info Display                â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Logout Button                    â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Page Content Area                â”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚   AuthContext                      â”‚                  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚    â”‚
â”‚  â”‚  â”‚ STATE:                             â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ isAuthenticated: boolean         â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ user: {username, role}           â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ loading: boolean                 â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚                                    â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ FUNCTIONS:                         â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ login(username, password)        â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ logout()                         â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚                                    â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ STORAGE:                           â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ localStorage.access_token        â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ localStorage.user                â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ localStorage.token_type          â”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚   API Client (axios)               â”‚                  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚    â”‚
â”‚  â”‚  â”‚ REQUEST INTERCEPTOR:               â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Get token from localStorage      â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Add Authorization header         â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Format: Bearer <token>           â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚                                    â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ RESPONSE INTERCEPTOR:              â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Handle 401 (redirect to login)  â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Handle 500 (show error)         â”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚                          HTTP/HTTPS with JWT                         â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†•â†•â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVER (FastAPI)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  API Routes                               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  PUBLIC ROUTES:                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /                 (Welcome)            â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /health           (Health Check)       â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ POST /api/v1/auth/login (Authentication)    â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  PROTECTED ROUTES (Requires JWT):                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /api/v1/auth/me                        â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ POST /api/v1/upload                         â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /api/v1/summary                        â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ POST /api/v1/recon/run                      â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /api/v1/recon/latest/summary           â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /api/v1/recon/latest/unmatched         â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /api/v1/recon/latest/hanging           â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /api/v1/reports/ttum                   â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ GET  /api/v1/enquiry                        â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ POST /api/v1/force-match                    â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ POST /api/v1/force-match/approve            â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ POST /api/v1/recon/rollback                 â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â†“ â†“ â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              JWT Token Processing                         â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  @app.post("/api/v1/auth/login")                         â”‚    â”‚
â”‚  â”‚  â”‚ 1. Receive username, password                         â”‚    â”‚
â”‚  â”‚  â”‚ 2. Call authenticate_user()                           â”‚    â”‚
â”‚  â”‚  â”‚ 3. If valid:                                          â”‚    â”‚
â”‚  â”‚  â”‚    - Generate JWT token                              â”‚    â”‚
â”‚  â”‚  â”‚    - Set expiry: now + 30 minutes                    â”‚    â”‚
â”‚  â”‚  â”‚    - Return: {access_token, user, token_type}        â”‚    â”‚
â”‚  â”‚  â”‚ 4. If invalid:                                        â”‚    â”‚
â”‚  â”‚  â”‚    - Return 401: Invalid credentials                 â”‚    â”‚
â”‚  â”‚  â””                                                        â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  Dependency: get_current_user()                          â”‚    â”‚
â”‚  â”‚  (Used by all protected endpoints)                       â”‚    â”‚
â”‚  â”‚  â”‚ 1. Extract token from Authorization header           â”‚    â”‚
â”‚  â”‚  â”‚ 2. Validate JWT signature (HS256)                    â”‚    â”‚
â”‚  â”‚  â”‚ 3. Check expiry (30 minute TTL)                      â”‚    â”‚
â”‚  â”‚  â”‚ 4. Decode token â†’ get username                       â”‚    â”‚
â”‚  â”‚  â”‚ 5. Lookup user in USERS_DB                           â”‚    â”‚
â”‚  â”‚  â”‚ 6. Attach user object to request                     â”‚    â”‚
â”‚  â”‚  â”‚ 7. If any step fails â†’ Return 401                    â”‚    â”‚
â”‚  â”‚  â””                                                        â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Authentication Components                    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  Configuration:                                          â”‚    â”‚
â”‚  â”‚  â”œâ”€ SECRET_KEY = "secret-key-here"                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ ALGORITHM = "HS256"                                  â”‚    â”‚
â”‚  â”‚  â””â”€ ACCESS_TOKEN_EXPIRE_MINUTES = 30                     â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  User Database (Hardcoded):                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ admin / admin123 (role: admin)                       â”‚    â”‚
â”‚  â”‚  â””â”€ Verif.AI / Recon (role: ops)                         â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  Functions:                                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ hash_password(pwd) â†’ SHA256 hash                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ verify_password(pwd, hash) â†’ boolean                â”‚    â”‚
â”‚  â”‚  â”œâ”€ create_access_token(data) â†’ JWT                      â”‚    â”‚
â”‚  â”‚  â”œâ”€ authenticate_user(user, pwd) â†’ user or None         â”‚    â”‚
â”‚  â”‚  â””â”€ get_current_user(token) â†’ user or 401               â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  Bearer Scheme:                                          â”‚    â”‚
â”‚  â”‚  â””â”€ HTTPBearer() - Extract token from header            â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            Protected Endpoint Example                     â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â”‚  @app.post("/api/v1/upload")                             â”‚    â”‚
â”‚  â”‚  async def upload_files(                                 â”‚    â”‚
â”‚  â”‚      files: List[UploadFile],                            â”‚    â”‚
â”‚  â”‚      user: dict = Depends(get_current_user)  â† AUTH      â”‚    â”‚
â”‚  â”‚  ):                                                       â”‚    â”‚
â”‚  â”‚      # Only runs if user authenticated                   â”‚    â”‚
â”‚  â”‚      log_audit(f"User {user['username']} uploaded")      â”‚    â”‚
â”‚  â”‚      # Process files...                                  â”‚    â”‚
â”‚  â”‚      return result                                       â”‚    â”‚
â”‚  â”‚                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Sequence Diagram: Login Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browserâ”‚                  â”‚ Frontendâ”‚                  â”‚ Backendâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                            â”‚                            â”‚
    â”‚ 1. Click login page        â”‚                            â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚                            â”‚
    â”‚                            â”‚                            â”‚
    â”‚                  2. Display form                        â”‚
    â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
    â”‚                            â”‚                            â”‚
    â”‚ 3. Enter: admin/admin123   â”‚                            â”‚
    â”‚         Click "Sign In"    â”‚                            â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚                            â”‚
    â”‚                            â”‚                            â”‚
    â”‚                      4. POST /api/v1/auth/login         â”‚
    â”‚                          {username, password}           â”‚
    â”‚                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’        â”‚
    â”‚                            â”‚                            â”‚
    â”‚                            â”‚  5. authenticate_user()    â”‚
    â”‚                            â”‚     verify password        â”‚
    â”‚                            â”‚     create JWT token       â”‚
    â”‚                            â”‚                            â”‚
    â”‚                      6. Return JWT token                â”‚
    â”‚                      {access_token, user}              â”‚
    â”‚                      â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
    â”‚                            â”‚                            â”‚
    â”‚                      7. Store in localStorage           â”‚
    â”‚                         Update state                    â”‚
    â”‚                                                         â”‚
    â”‚  8. Redirect to /dashboard                             â”‚
    â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
    â”‚                            â”‚                            â”‚
    â”‚ 9. User logged in! âœ“       â”‚                            â”‚
    â”‚                            â”‚                            â”‚
```

## Sequence Diagram: Protected API Call

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browserâ”‚                  â”‚ Frontendâ”‚                  â”‚ Backendâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                            â”‚                            â”‚
    â”‚ 1. Click "View Summary"    â”‚                            â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚                            â”‚
    â”‚                            â”‚                            â”‚
    â”‚                   2. Get token from localStorage        â”‚
    â”‚                      Add header:                        â”‚
    â”‚                      Authorization: Bearer <token>      â”‚
    â”‚                                                         â”‚
    â”‚                      3. GET /api/v1/summary             â”‚
    â”‚                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’        â”‚
    â”‚                            â”‚                            â”‚
    â”‚                            â”‚  4. get_current_user()     â”‚
    â”‚                            â”‚     Extract token from header
    â”‚                            â”‚     Validate JWT signature â”‚
    â”‚                            â”‚     Check expiry (30 min)  â”‚
    â”‚                            â”‚     Decode â†’ get username  â”‚
    â”‚                            â”‚     Lookup user in DB      â”‚
    â”‚                            â”‚     Attach user to request â”‚
    â”‚                            â”‚                            â”‚
    â”‚                            â”‚  5. Execute endpoint       â”‚
    â”‚                            â”‚     Generate summary       â”‚
    â”‚                            â”‚                            â”‚
    â”‚                      6. Return JSON data                â”‚
    â”‚                      â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
    â”‚                            â”‚                            â”‚
    â”‚ 7. Display data in table   â”‚                            â”‚
    â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
    â”‚                            â”‚                            â”‚
```

## Token Structure

```
JWT Token Format:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.
eyJzdWIiOiJhZG1pbiIsImV4cCI6MTcxNjU0MzIwMH0.
abcdef123456...

â”‚                                    â”‚
â”‚  HEADER (Base64 encoded)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                  â”‚
â”‚   "typ": "JWT",                   â”‚
â”‚   "alg": "HS256"                  â”‚
â”‚ }                                  â”‚
â”‚                                    â”‚
                     .
                     
â”‚                                    â”‚
â”‚  PAYLOAD (Base64 encoded)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                  â”‚
â”‚   "sub": "admin",                 â”‚
â”‚   "exp": 1716543200               â”‚
â”‚ }                                  â”‚
â”‚                                    â”‚
(Contains username and expiry)
                     .
                     
â”‚                                    â”‚
â”‚  SIGNATURE (Encrypted)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HMACSHA256(                        â”‚
â”‚   header.payload,                 â”‚
â”‚   "secret-key-here"               â”‚
â”‚ )                                  â”‚
â”‚                                    â”‚
(Prevents tampering)
```

## Authentication State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   START     â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  LOAD APP   â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                  â†“               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Token in Storage?â”‚  â”‚   Loading State  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚       â”‚
             YES     NO
              â”‚       â”‚
              â†“       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  AUTHENTICATED   â”‚  â”‚  UNAUTHENTICATED â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                       â”‚
               â”‚                       â†“
               â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚              â”‚   SHOW LOGIN     â”‚
               â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                       â”‚
               â”‚              User enters credentials
               â”‚                       â”‚
               â”‚                       â†“
               â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚              â”‚ VALIDATE CREDS   â”‚
               â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
               â”‚                   â”‚       â”‚
               â”‚              Valid  Invalid
               â”‚                   â”‚       â”‚
               â”‚                   â†“       â†“
               â”‚              â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
               â”‚              â”‚ âœ“   â”‚  â”‚ âœ—    â”‚
               â”‚              â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜
               â”‚                 â”‚        â”‚
               â”‚                 â”‚        â””â”€â†’ Show Error
               â”‚                 â”‚            â†“
               â”‚                 â”‚        [User tries again]
               â”‚                 â”‚            â”‚
               â”‚                 â”‚            â””â”€â†’ Circles back to LOGIN
               â”‚                 â”‚
               â”‚                 â†“
               â”‚          Generate JWT
               â”‚          Store Token
               â”‚          Update State
               â”‚                 â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  AUTHENTICATED   â”‚
                â”‚ (Can access ALL) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                   User clicks logout
                    OR token expires
                    (30 min TTL)
                         â”‚
                         â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ CLEAR TOKEN      â”‚
                â”‚ RESET STATE      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ UNAUTHENTICATED  â”‚
                â”‚ Redirect to /login
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling Flow

```
API Request with Token
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Check header â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ No token?
         â”‚  â””â”€â”€â†’ 401: Not authenticated
         â”‚
         â””â”€ Token exists?
            â”‚
            â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Decode JWT       â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”œâ”€ Invalid signature?
                â”‚  â””â”€â”€â†’ 401: Invalid authentication
                â”‚
                â”œâ”€ Malformed?
                â”‚  â””â”€â”€â†’ 401: Invalid authentication
                â”‚
                â””â”€ Valid?
                   â”‚
                   â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Check expiry     â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”œâ”€ Expired?
                       â”‚  â””â”€â”€â†’ 401: Token expired
                       â”‚
                       â””â”€ Valid?
                          â”‚
                          â†“
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ Lookup user      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”œâ”€ Not found?
                              â”‚  â””â”€â”€â†’ 401: Invalid authentication
                              â”‚
                              â””â”€ Found?
                                 â”‚
                                 â†“
                              âœ“ 200: Success
                              Attach user to request
                              Execute endpoint
```

---

## Component Interactions

```
â”Œâ”€ AuthProvider (Context)
â”‚  â”‚
â”‚  â”œâ”€ Provides: isAuthenticated, user, login, logout
â”‚  â”‚
â”‚  â””â”€ Used by:
â”‚     â”œâ”€ ProtectedRoute (checks isAuthenticated)
â”‚     â”œâ”€ Layout (displays user, logout)
â”‚     â”œâ”€ Login (calls login function)
â”‚     â””â”€ All pages (via useAuth hook)

â”Œâ”€ ProtectedRoute
â”‚  â”‚
â”‚  â”œâ”€ Wraps: Protected pages
â”‚  â”‚
â”‚  â”œâ”€ Checks: useAuth().isAuthenticated
â”‚  â”‚
â”‚  â””â”€ Actions:
â”‚     â”œâ”€ If authenticated â†’ Render children
â”‚     â”œâ”€ If loading â†’ Show loading
â”‚     â””â”€ If not authenticated â†’ Redirect to /login

â”Œâ”€ Login Page
â”‚  â”‚
â”‚  â”œâ”€ Shows: Form with username/password
â”‚  â”‚
â”‚  â”œâ”€ On submit:
â”‚  â”‚  â”œâ”€ Get form values
â”‚  â”‚  â”œâ”€ Call useAuth().login(username, password)
â”‚  â”‚  â”œâ”€ Login endpoint: POST /api/v1/auth/login
â”‚  â”‚  â”œâ”€ If success: Redirect to /
â”‚  â”‚  â””â”€ If error: Show error message
â”‚  â”‚
â”‚  â””â”€ Auto-redirects if already authenticated

â”Œâ”€ Layout Component
â”‚  â”‚
â”‚  â”œâ”€ Shows: User info, sidebar menu, logout button
â”‚  â”‚
â”‚  â”œâ”€ Uses: useAuth() for user data
â”‚  â”‚
â”‚  â””â”€ On logout click:
â”‚     â”œâ”€ Call useAuth().logout()
â”‚     â”œâ”€ Clear localStorage
â”‚     â”œâ”€ Reset AuthContext state
â”‚     â””â”€ Redirect to /login

â”Œâ”€ API Client (axios)
â”‚  â”‚
â”‚  â”œâ”€ Request Interceptor:
â”‚  â”‚  â”œâ”€ Get token from localStorage
â”‚  â”‚  â””â”€ Add Authorization: Bearer <token>
â”‚  â”‚
â”‚  â””â”€ Response Interceptor:
â”‚     â”œâ”€ If 401: Token invalid/expired
â”‚     â””â”€ If 5xx: Server error
```

---

This comprehensive architecture ensures:
âœ… Secure authentication with JWT
âœ… Protected API endpoints
âœ… Protected frontend routes
âœ… Token persistence and management
âœ… Proper error handling
âœ… Clean component separation
âœ… Global state management
